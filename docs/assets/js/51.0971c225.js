(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{215:function(e,i,t){"use strict";t.r(i);var n=t(0),v=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{staticClass:"content"},[t("h4",{attrs:{id:"如何保证service在后台不被kill"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#如何保证service在后台不被kill","aria-hidden":"true"}},[e._v("#")]),e._v(" 如何保证service在后台不被Kill")]),e._v(" "),t("p",[e._v("一、onStartCommand方法，返回START_STICKY")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("START_STICKY\n在运行onStartCommand后service进程被kill后，那将保留在开始状态，但是不保留那些传入的intent。不久后service就会再次尝试重新创建，因为保留在开始状态，在创建     service后将保证调用onstartCommand。如果没有传递任何开始命令给service，那将获取到null的intent。")])]),e._v(" "),t("li",[t("p",[e._v("START_NOT_STICKY\n在运行onStartCommand后service进程被kill后，并且没有新的intent传递给它。Service将移出开始状态，并且直到新的明显的方法（startService）调用才重新创建。因为如果没有传递任何未决定的intent那么service是不会启动，也就是期间onstartCommand不会接收到任何null的intent。")])]),e._v(" "),t("li",[t("p",[e._v("START_REDELIVER_INTENT\n在运行onStartCommand后service进程被kill后，系统将会再次启动service，并传入最后一个intent给onstartCommand。直到调用stopSelf(int)才停止传递intent。如果在被kill后还有未处理好的intent，那被kill后服务还是会自动启动。因此onstartCommand不会接收到任何null的intent。")])])]),e._v(" "),t("p",[e._v("二、提升service进程优先级")]),e._v(" "),t("p",[e._v("Android中的进程是托管的，当系统进程空间紧张的时候，会依照优先级自动进行进程的回收。Android将进程分为6个等级,它们按优先级顺序由高到低依次是:")]),e._v(" "),t("ol",[t("li",[e._v("前台进程( FOREGROUND_APP)")]),e._v(" "),t("li",[e._v("可视进程(VISIBLE_APP )")]),e._v(" "),t("li",[e._v("次要服务进程(SECONDARY_SERVER )")]),e._v(" "),t("li",[e._v("后台进程 (HIDDEN_APP)")]),e._v(" "),t("li",[e._v("内容供应节点(CONTENT_PROVIDER)")]),e._v(" "),t("li",[e._v("空进程(EMPTY_APP)")])]),e._v(" "),t("p",[e._v("当service运行在低内存的环境时，将会kill掉一些存在的进程。因此进程的优先级将会很重要，可以使用startForeground 将service放到前台状态。这样在低内存时被kill的几率会低一些。")]),e._v(" "),t("p",[e._v("三、onDestroy方法里重启service")]),e._v(" "),t("p",[e._v("service +broadcast  方式，就是当service走ondestory的时候，发送一个自定义的广播，当收到广播的时候，重新启动service；")]),e._v(" "),t("p",[e._v("四、Application加上Persistent属性")]),e._v(" "),t("p",[e._v("五、监听系统广播判断Service状态")]),e._v(" "),t("p",[e._v("通过系统的一些广播，比如：手机重启、界面唤醒、应用状态改变等等监听并捕获到，然后判断我们的Service是否还存活，别忘记加权限啊。")])])}],!1,null,null,null);v.options.__file="如何保证service在后台不被kill.md";i.default=v.exports}}]);